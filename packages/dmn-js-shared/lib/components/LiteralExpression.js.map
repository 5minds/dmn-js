{"version":3,"file":"LiteralExpression.js","names":["Component","FeelEditor","EditorView","LiteralExpression","constructor","props","context","node","editor","state","value","componentDidMount","contentAttributes","label","container","onChange","handleChange","variables","extensions","lineWrapping","addEventListener","handleMouseEvent","handleKeyDownCapture","handleKeyDown","autoFocus","focus","length","componentDidUpdate","prevProps","setState","setValue","deepEqual","setVariables","componentWillUnmount","removeEventListener","event","stopPropagation","key","isAutocompleteOpen","triggeredFromAutocomplete","ctrlForNewline","isCmd","preventDefault","singleLine","includes","onInput","handleBlur","onBlur","setNode","render","createVNode","className","join","null","onFocus","metaKey","ctrlKey","querySelector","a","b","JSON","stringify"],"sources":["../../src/components/LiteralExpression.js"],"sourcesContent":["import { Component } from 'inferno';\n\nimport FeelEditor from '@bpmn-io/feel-editor';\n\nimport { EditorView } from '@codemirror/view';\n\n/**\n * A drop-in replacement for ContentEditable which uses FEEL editor under the hood.\n * It does not support placeholder.\n *\n * The callback `onInput(text)` receives text (including line breaks)\n * only. Updating the value via props will update the selection\n * if needed, too.\n *\n * @example\n *\n * class SomeComponent extends Component {\n *\n *   render() {\n *     return (\n *       <LiteralExpression\n *         className=\"some classes\"\n *         value={ this.state.text }\n *         onInput={ this.handleInput }\n *         onChange={ this.handleChange }\n *         onFocus={ ... }\n *         onBlur={ ... } />\n *     );\n *   }\n *\n * }\n *\n */\nexport default class LiteralExpression extends Component {\n\n  constructor(props, context) {\n    super(props, context);\n\n    /** @type {HTMLElement} */\n    this.node = null;\n    this.editor = null;\n\n    this.state = {\n      value: props.value\n    };\n  }\n\n  componentDidMount() {\n    this.editor = new FeelEditor({\n      contentAttributes: {\n        'aria-label': this.props.label\n      },\n      container: this.node,\n      onChange: this.handleChange,\n      value: this.state.value,\n      variables: this.props.variables || [],\n      extensions: [\n        EditorView.lineWrapping\n      ]\n    });\n\n    this.node.addEventListener('mousedown', this.handleMouseEvent);\n\n    // `capture: true` is needed to precede Keyboard handlers\n    this.node.addEventListener('keydown', this.handleKeyDownCapture, true);\n    this.node.addEventListener('keydown', this.handleKeyDown);\n\n    if (this.props.autoFocus) {\n      this.editor.focus(this.state.value.length);\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const { value } = this.props;\n\n    if (prevProps.value !== value && value !== this.state.value) {\n      this.setState({\n        value\n      }, () => {\n        this.editor.setValue(value);\n      });\n    }\n\n    if (!deepEqual(prevProps.variables, this.props.variables)) {\n      this.editor.setVariables(this.props.variables);\n    }\n  }\n\n  componentWillUnmount() {\n    this.node.removeEventListener('mousedown', this.handleMouseEvent);\n\n    // `capture: true` is needed to precede FEEL editor default handling\n    this.node.removeEventListener('keydown', this.handleKeyDownCapture, true);\n    this.node.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleMouseEvent = event => {\n    event.stopPropagation();\n  };\n\n  handleKeyDownCapture = event => {\n    if (event.key === 'Enter') {\n      if (isAutocompleteOpen(this.node)) {\n        event.triggeredFromAutocomplete = true;\n        return;\n      }\n\n      // supress non cmd+enter newline\n      if (this.props.ctrlForNewline && !isCmd(event)) {\n        event.preventDefault();\n      }\n\n      if (this.props.singleLine) {\n        event.preventDefault();\n      }\n    }\n  };\n\n  /**\n   * @param {KeyboardEvent} event\n   */\n  handleKeyDown = event => {\n\n    // contain the event in the component to not trigger global handlers\n    if ([ 'Enter', 'Escape' ].includes(event.key) && event.triggeredFromAutocomplete) {\n      event.stopPropagation();\n    }\n  };\n\n  handleChange = (value) => {\n    const { onInput } = this.props;\n\n    this.setState({\n      value\n    });\n\n    if (onInput) {\n      onInput(value);\n    }\n  };\n\n  handleBlur = () => {\n    const { onBlur, onChange } = this.props;\n\n    if (onChange && this.state.value !== this.props.value) {\n      onChange(this.state.value);\n    }\n\n    if (onBlur) {\n      onBlur();\n    }\n  };\n\n  setNode = node => {\n    this.node = node;\n  };\n\n  render() {\n    return (\n      <div\n        className={ [ 'literal-expression', this.props.className || '' ].join(' ') }\n        ref={ this.setNode }\n        onClick={ this.handleMouseEvent }\n        onFocusIn={ this.props.onFocus }\n        onFocusOut={ this.handleBlur }\n      />\n    );\n  }\n}\n\nfunction isCmd(event) {\n  return event.metaKey || event.ctrlKey;\n}\n\nfunction isAutocompleteOpen(node) {\n  return node.querySelector('.cm-tooltip-autocomplete');\n}\n\nfunction deepEqual(a, b) {\n  return JSON.stringify(a) === JSON.stringify(b);\n}\n"],"mappings":"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","ignoreList":[]}